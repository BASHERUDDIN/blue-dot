<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blue Dot AI</title>
<style>
body{
  margin:0;
  background:black;
  overflow:hidden;
}
canvas{
  position:absolute;
}
.controls{
  position:absolute;
  bottom:40px;
  width:100%;
  text-align:center;
}
button{
  padding:12px 25px;
  margin:5px;
  font-size:16px;
  border:none;
  border-radius:25px;
  background:#1e90ff;
  color:white;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="controls">
  <button onclick="startMic()">Start</button>
  <button onclick="stopMic()">Stop</button>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let amplitude = 0;
let stream = null;
let audioContext = null;
let analyser = null;
let listening = false;
let ringRotation = 0;

// Smooth pupil movement
let pupilTargetX = 0;
let pupilTargetY = 0;
let pupilX = 0;
let pupilY = 0;

setInterval(()=>{
  pupilTargetX = (Math.random()-0.5)*20;
  pupilTargetY = (Math.random()-0.5)*10;
},2500);

async function startMic(){
  stream = await navigator.mediaDevices.getUserMedia({audio:true});
  audioContext = new AudioContext();
  const source = audioContext.createMediaStreamSource(stream);
  analyser = audioContext.createAnalyser();
  analyser.fftSize = 256;
  source.connect(analyser);
  listening = true;
  updateAudio();
}

function stopMic(){
  if(stream){
    stream.getTracks().forEach(track=>track.stop());
  }
  if(audioContext){
    audioContext.close();
  }
  listening = false;
  amplitude = 0;
}

function updateAudio(){
  if(!analyser) return;
  const dataArray = new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteTimeDomainData(dataArray);
  let sum = 0;
  for(let i=0;i<dataArray.length;i++){
    const v=(dataArray[i]-128)/128;
    sum+=v*v;
  }

  let raw = Math.sqrt(sum/dataArray.length)*600;

  // Smooth amplitude
  amplitude = amplitude*0.7 + raw*0.3;

  requestAnimationFrame(updateAudio);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const w=canvas.width;
  const h=canvas.height;

  const eyeY=h*0.35;
  const leftX=w*0.35;
  const rightX=w*0.65;

  // Smooth pupil movement interpolation
  pupilX += (pupilTargetX - pupilX)*0.05;
  pupilY += (pupilTargetY - pupilY)*0.05;

  // Eyes
  ctx.fillStyle="#4da6ff";
  ctx.beginPath();
  ctx.arc(leftX,eyeY,65,0,Math.PI*2);
  ctx.fill();

  ctx.beginPath();
  ctx.arc(rightX,eyeY,65,0,Math.PI*2);
  ctx.fill();

  // Pupils
  ctx.fillStyle="#001933";
  ctx.beginPath();
  ctx.arc(leftX+pupilX,eyeY+pupilY,22,0,Math.PI*2);
  ctx.fill();

  ctx.beginPath();
  ctx.arc(rightX+pupilX,eyeY+pupilY,22,0,Math.PI*2);
  ctx.fill();

  // Rotating rings
  ctx.strokeStyle="#003366";
  ctx.lineWidth=6;
  ringRotation+=0.015;

  ctx.save();
  ctx.translate(leftX,eyeY);
  ctx.rotate(ringRotation);
  ctx.beginPath();
  ctx.arc(0,0,55,0,Math.PI*2);
  ctx.stroke();
  ctx.restore();

  ctx.save();
  ctx.translate(rightX,eyeY);
  ctx.rotate(ringRotation);
  ctx.beginPath();
  ctx.arc(0,0,55,0,Math.PI*2);
  ctx.stroke();
  ctx.restore();

  // Mouth vibration (clear but controlled)
  const mouthY=h*0.65;
  ctx.lineWidth=12;

  let tilt = listening ? amplitude : 0;

  ctx.beginPath();
  ctx.moveTo(w*0.45,mouthY - tilt/2);
  ctx.lineTo(w*0.55,mouthY + tilt/2);
  ctx.stroke();

  // Listening bars
  if(listening){
    ctx.fillStyle="#003366";
    ctx.fillRect(50,eyeY-50,14,110+amplitude/2);
    ctx.fillRect(w-64,eyeY-50,14,110+amplitude/2);
  }

  requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>
